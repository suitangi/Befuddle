function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function recreateNode(e,t){if(t)e.parentNode.replaceChild(e.cloneNode(!0),e);else{for(var a=e.cloneNode(!1);e.hasChildNodes();)a.appendChild(e.firstChild);e.parentNode.replaceChild(a,e)}}function requestCard(e){document.getElementById("cardImage").style="opacity:0; transition: opacity 0s;",document.getElementById("imageLoading").style="",fetch("https://api.scryfall.com/cards/"+e).then((e=>e.json())).then((e=>loadCard(e)))}function isAlpha(e){return c=e.toLowerCase().charCodeAt(0),c>=97&&c<=122}function loadCard(e){window.mtgCard={},window.mtgCard.end=!1,window.mtgCard.id=e.id,window.mtgCard.wrongGuess="",window.mtgCard.lives=window.game[window.game.mode].lives,window.mtgCard.guesses=new Set,window.mtgCard.cardData=e,"free"==window.game.mode&&(window.mtgCard.hideBlanks=window.game.free.hideBlanks);let t=document.getElementById("keyboard").children;for(var a=0;a<t.length;a++)t[a].classList.remove("correct"),t[a].classList.remove("incorrect"),t[a].classList.remove("redText"),t[a].innerText=t[a].getAttribute("data-key");if(document.getElementById("seeCard").style="display:none;","transform"==e.layout||"modal_dfc"==e.layout){getParameterByName("cardFace")?window.mtgCard.cardFac=getParameterByName("cardFace"):window.mtgCard.cardFace=Math.floor(Math.random()*e.card_faces.length);let t=e.card_faces[window.mtgCard.cardFace];e.mana_cost=t.mana_cost,e.colors=t.colors,e.image_uris=t.image_uris,e.name=t.name}let n="";if("free"==window.game.mode&&2==window.game.free.manaState||"daily"==window.game.mode){if(""==e.mana_cost)n="No mana cost";else{if(window.mtgCard.manaCost=[],"split"==e.layout||"adventure"==e.layout||"flip"==e.layout){let t=e.mana_cost.split(" // ");for(a=0;a<t.length;a++)a>0&&window.mtgCard.manaCost.push("//"),window.mtgCard.manaCost=window.mtgCard.manaCost.concat(t[a].substring(1,t[a].length-1).split("}{"))}else window.mtgCard.manaCost=window.mtgCard.manaCost.concat(e.mana_cost.substring(1,e.mana_cost.length-1).split("}{"));for(a=0;a<window.mtgCard.manaCost.length;a++)""!=window.mtgCard.manaCost[a]&&("//"==window.mtgCard.manaCost[a]?n+=" // ":n+='<img class="manaSymbol" src="'+window.mtgSymbols[window.mtgCard.manaCost[a]]+'">')}n+="<br><br>"}else if("free"==window.game.mode&&1==window.game.free.manaState){if(n="Color"+(e.colors.length<2?"":"s")+": ",0==e.colors.length)n+='<img class="manaSymbol" src="'+window.mtgSymbols.C+'">';else for(a=0;a<e.colors.length;a++)n+='<img class="manaSymbol" src="'+window.mtgSymbols[e.colors[a]]+'">';n+="<br><br>"}else n="";document.getElementById("cardMana").innerHTML=n;var o=document.getElementById("cardImage"),i=new Image;i.onload=function(){o.src=this.src,document.getElementById("cardImage").style="opacity:1;",document.getElementById("imageLoading").style="display:none;"},i.src=e.image_uris.art_crop;let d=e.name;window.mtgCard.hideBlanks?window.mtgCard.hiddenName=hideName(d,""):window.mtgCard.hiddenName=hideName(d,"_"),document.getElementById("cardName").innerText=window.mtgCard.hiddenName,document.getElementById("card").style=""}function submitLetter(t){if(window.mtgCard.guesses.has(t))return;window.mtgCard.guesses.add(t);let a=!1,n=t.toUpperCase(),o=window.mtgCard.cardData.name,i="";for(var d=0;d<o.length;d++)o.charAt(d)==t||o.charAt(d)==n?(a=!0,i+=o.charAt(d)):window.mtgCard.hideBlanks?!window.mtgCard.guesses.has(o.toLowerCase().charAt(d))&&isAlpha(o.charAt(d))||(i+=o.charAt(d)):i+=window.mtgCard.hiddenName.charAt(d);if(a)window.displayKeyboard[t].classList.add("correct"),window.mtgCard.hiddenName=i,document.getElementById("cardName").innerText=window.mtgCard.hiddenName,window.mtgCard.hiddenName==window.mtgCard.cardData.name&&(window.mtgCard.end=!0,document.getElementById("seeCard").style="","free"==window.game.mode?gameWinFree():"daily"==window.game.mode&&gameWinDaily());else if(window.mtgCard.wrongGuess+=t,window.displayKeyboard[t].classList.add("incorrect"),-1!=window.mtgCard.lives){for(e of(window.mtgCard.lives--,window.displayKeyboard[t].classList.add("redText"),document.getElementsByClassName("incorrect")))e.innerText=window.mtgCard.lives;0==window.mtgCard.lives&&(window.mtgCard.end=!0,document.getElementById("seeCard").style="","free"==window.game.mode?gameLostFree():"daily"==window.game.mode&&gameLostDaily())}}function seeCardHandler(){window.mtgCard.hiddenName==window.mtgCard.cardData.name?"free"==window.game.mode?gameWinFree():"daily"==window.game.mode&&gameWinDaily():"free"==window.game.mode?gameLostFree():"daily"==window.game.mode&&gameLostDaily()}function gameLostFree(){$.confirm({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">Totally Lost</span>",content:getCardHtml(),theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,useBootstrap:!1,typeAnimated:!0,closeIcon:!0,buttons:{link:{text:"Share",btnClass:"btn-green",action:function(e){return clipboardHandler(e,"Befuddle: X\nhttps://suitangi.github.io/Befuddle/?cardId="+window.mtgCard.id),!1}},close:{text:"Next Card",btnClass:"btn-blue",keys:["enter"],action:function(){requestCard(window.cardList[Math.floor(Math.random()*window.cardList.length)])}}}})}function gameLostDaily(){$.confirm({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">Totally Lost</span>",content:getCardHtml(),theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,useBootstrap:!1,typeAnimated:!0,closeIcon:!0,buttons:{close:{text:"Stats",btnClass:"btn-blue",action:function(){statsModal()}},link:{text:"Share",btnClass:"btn-green",action:function(e){return clipboardHandler(e,"Daily Befuddle "+(new Date).toLocaleDateString("en-US")+"\nX\nhttps://suitangi.github.io/Befuddle/"),!1}}}})}function gameWinDaily(){let e=window.mtgCard.wrongGuess.length;$.confirm({title:"<span style=\"font-family: 'Beleren Bold';\">"+getWinTerms(e)+(0!=e?" — "+e+" wrong":"")+"</span>",content:getCardHtml(),theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,useBootstrap:!1,typeAnimated:!0,closeIcon:!0,buttons:{close:{text:"Stats",btnClass:"btn-blue",action:function(){statsModal()}},link:{text:"Share",btnClass:"btn-green",action:function(t){return clipboardHandler(t,"Daily Befuddle "+(new Date).toLocaleDateString("en-US")+"\n"+e+"/"+window.game.daily.lives+"\nhttps://suitangi.github.io/Befuddle/"),!1}}}})}function gameWinFree(){let e=window.mtgCard.wrongGuess.length;$.confirm({title:"<span style=\"font-family: 'Beleren Bold';\">"+getWinTerms(e)+(0!=e?" — "+e+" wrong":"")+"</span>",content:getCardHtml(),theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,useBootstrap:!1,typeAnimated:!0,closeIcon:!0,buttons:{link:{text:"Share",btnClass:"btn-green",action:function(t){return clipboardHandler(t,"Befuddle: "+e+" wrong guess"+(1==e?"":"es")+(window.mtgCard.hideBlanks?"*":"")+" \nhttps://suitangi.github.io/Befuddle/?cardId="+window.mtgCard.id),!1}},close:{text:"Next Card",btnClass:"btn-blue",keys:["enter"],action:function(){requestCard(window.cardList[Math.floor(Math.random()*window.cardList.length)])}}}})}function clipboardHandler(e,t){navigator.clipboard.writeText(t).then((function(){e.addClass("displayButton"),e.setText("Copied!"),e.addClass("btn-dark"),e.removeClass("btn-green"),setTimeout((function(t){e.removeClass("btn-dark"),e.addClass("btn-green")}),100,e),setTimeout((function(t){e.setText("Share")}),3e3,e)}),(function(){clipboardError(t)}))}function clipboardError(e){$.dialog({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">Error: Clipboard Access Denied</span>",content:'<span style="font-family: \'Beleren Bold\';">You can manually copy the text below:<br><br><div class="copyText">'+e+"</div></span>",type:"red",theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,useBootstrap:!1,typeAnimated:!0,backgroundDismiss:!0})}function getCardHtml(){let e;return e="transform"==window.mtgCard.cardData.layout||"modal_dfc"==window.mtgCard.cardData.layout?'<div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front"><img src="'+window.mtgCard.cardData.card_faces[window.mtgCard.cardFace].image_uris.normal+'" style="border-radius:5%;"><span class="material-symbols-outlined flip-symbol-front"> chevron_right </span></div> <div class="flip-card-back"><img src="'+window.mtgCard.cardData.card_faces[1-window.mtgCard.cardFace].image_uris.normal+'" style="border-radius:5%;"><span class="material-symbols-outlined flip-symbol-back"> chevron_left </span></div></div></div>':'<img src="'+window.mtgCard.cardData.image_uris.normal+'" style="border-radius:5%;">',e}function getWinTerms(e){return 1==window.mtgCard.lives?"Final Fortune":["Compleat Perfection!","Ancestrally Recalled","Thought Twice","Pondered Well","Delved into Secrets","Pieces Pored Over","Faithlessly Looted","Tome Scoured","Dashed Hopes","Thoughts Siezed","Mind Ground","Wildly Guessed","Yawgmoth's Wouldn't","Triskaidekaphobia!","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank","Gone Blank"][e]}function hideName(e,t){let a="";for(var n=0;n<e.length;n++)isAlpha(e.charAt(n))?a+=t:a+=e.charAt(n);return a}function helpModal(){"daily"==window.game.mode?$.dialog({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">How to Play</span>",content:"<span style=\"font-family: 'Beleren Bold';\">This is the help page for the daily game</span>",theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,backgroundDismiss:!0,useBootstrap:!1}):"free"==window.game.mode&&$.dialog({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">How to Play</span>",content:"<span style=\"font-family: 'Beleren Bold';\">This is the help page for the free play game</span>",theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,backgroundDismiss:!0,useBootstrap:!1})}function settingsModal(){let e="";if("daily"==window.game.mode)e+='<div class="gameSettings"><br><span class="menuText" id="hmdisplay">Hidden mode</span><label class="switch"><input id="hmInput" type="checkbox" '+(window.game.free.hideBlanks?"checked":"")+'><div><span></span></div></label><span class="smallText">Hidden mode hides the letter blanks.</span><br><br><div class="hr"></div><span class="smallText">Changes won\'t apply until the next game you play.</span><br></div>',$.dialog({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">Options</span>",content:e,theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,backgroundDismiss:!0,useBootstrap:!1,onContentReady:function(){this.$content.find("#hideInput").on("input",(function(){window.game.daily.hideBlanks=this.checked}))}});else if("free"==window.game.mode){let t=["Show Nothing","Show Colors","Show Mana Cost"];e+='<div class="gameSettings"><br><span class="menuText">Lives: <span id="livesdisplay">'+(-1==window.game.free.lives?"Off":window.game.free.lives)+'</span></span><div class="slidecontainer"><input id="livesInput" type="range" min="0" max="25" value="'+window.game.free.lives+'" class="slider"></div><br><span class="menuText" id="manadisplay">'+t[window.game.free.manaState]+'</span><div class="slidecontainer"><input id="manaInput" type="range" min="0" max="2" value="'+window.game.free.manaState+'" class="slider"></div><br><span class="menuText" id="hidedisplay">Hidden Mode</span><label class="switch"><input id="hideInput" type="checkbox" '+(window.game.free.hideBlanks?"checked":"")+'><div><span></span></div></label><span class="smallText">Hidden mode hides the letter blanks.</span><br><br><div class="hr"></div><span class="smallText">Game changes won\'t be adjusted until next card.</span><br></div>',$.dialog({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">Options</span>",content:e,theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,backgroundDismiss:!0,useBootstrap:!1,onContentReady:function(){this.$content.find("#livesInput").on("input",(function(){this.value>0?(document.getElementById("livesdisplay").innerText=this.value,window.game.free.lives=this.value):0==this.value&&(document.getElementById("livesdisplay").innerText="Off",window.game.free.lives=-1)})),this.$content.find("#manaInput").on("input",(function(){window.game.free.manaState=this.value,document.getElementById("manadisplay").innerText=["Show Nothing","Show Colors","Show Mana Cost"][this.value]})),this.$content.find("#hideInput").on("input",(function(){window.game.free.hideBlanks=this.checked}))}})}}function statsModal(){$.dialog({title:"<span style=\"font-family: 'Beleren Bold';font-size:25px;\">Statistics</span>",content:"<span style=\"font-family: 'Beleren Bold';\">Statistics Page\nStatistics Page\nStatistics Page\nStatistics Page\nStatistics Page\nStatistics Page\nStatistics Page\nStatistics Page\n</span>",theme:"dark",animation:"top",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,backgroundDismiss:!0,useBootstrap:!1})}function mainMenuDisplay(){$.confirm({title:"<span style=\"font-family: 'Beleren Bold';font-size:30px;line-height: 30px;\">Welcome to Befuddle</span>",content:"<span style=\"font-family: 'Beleren Bold';user-select:none;\">Select your game mode:</span>",theme:"supervan",animation:"opacity",closeAnimation:"top",animateFromElement:!1,boxWidth:"min(400px, 80%)",draggable:!1,backgroundDismiss:!1,backgroundDismissAnimation:"none",useBootstrap:!1,buttons:{daily:{text:"<span style=\"font-family: 'Beleren Bold';user-select:none;\">Daily Befuddle</span>",action:function(){window.game.mode="daily",loadGame()}},free:{text:"<span style=\"font-family: 'Beleren Bold';user-select:none;\">Free Play</span>",action:function(){window.game.mode="free",loadGame()}}}})}function loadGame(){if(null==window.game.mode)return void mainManuDisplay();let e=document.getElementById("keyboard").children;for(var t=0;t<e.length;t++)window.displayKeyboard[e[t].innerText.toLowerCase()]=e[t],e[t].setAttribute("data-key",e[t].innerText),e[t].addEventListener("click",(function(){submitLetter(this.getAttribute("data-key").toLowerCase())}));document.onkeypress=function(e){e=e||window.event,!window.mtgCard.end&&e.keyCode>=97&&e.keyCode<=122&&submitLetter(String.fromCharCode(e.keyCode)),!window.mtgCard.end&&e.keyCode>=65&&e.keyCode<=90&&submitLetter(String.fromCharCode(e.keyCode).toLowerCase())},"daily"==window.game.mode?fetch("https://raw.githubusercontent.com/suitangi/Befuddle/main/dailyList.json").then((e=>e.json())).then((e=>{document.getElementById("cardImage").style="opacity:0; transition: opacity 0s;",document.getElementById("imageLoading").style="",loadCard(e[(new Date).getDOY()])})):"free"==window.game.mode&&fetch("https://raw.githubusercontent.com/suitangi/Befuddle/main/cardList.json").then((e=>e.json())).then((e=>{window.cardList=e,getParameterByName("cardId")?requestCard(getParameterByName("cardId")):requestCard(window.cardList[Math.floor(Math.random()*window.cardList.length)])}))}$(document).ready((function(){console.log("https://scryfall.com/card/unh/30/cheatyface"),window.displayKeyboard={},window.game={},window.game.daily={},window.game.daily.lives=7,window.game.daily.hideBlanks=!1,window.game.free={},window.game.free={},window.game.free.lives=-1,window.game.free.manaState=2,window.game.free.hideBlanks=!1,getParameterByName("cardId")?(window.game.mode="free",loadGame()):mainMenuDisplay(),document.getElementById("stats-button").addEventListener("click",(function(){statsModal()})),document.getElementById("settings-button").addEventListener("click",(function(){settingsModal()})),document.getElementById("help-button").addEventListener("click",(function(){helpModal()})),document.getElementById("seeCard").addEventListener("click",(function(){seeCardHandler()}))})),Date.prototype.isLeapYear=function(){var e=this.getFullYear();return 0==(3&e)&&(e%100!=0||e%400==0)},Date.prototype.getDOY=function(){var e=this.getMonth(),t=this.getDate(),a=[0,31,59,90,120,151,181,212,243,273,304,334][e]+t;return e>1&&this.isLeapYear()&&a++,a};
